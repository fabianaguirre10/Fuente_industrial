@model Mardis.Engine.Web.ViewModel.UserViewModels.UserViewModel

@{
    ViewData["Title"] = "Gestión de Usuarios";
    ViewData["Description"] = "Crear / Editar Usuarios";
}

@section buttons{}
@section filters{}

<style>
    .kv-avatar .file-preview-frame, .kv-avatar .file-preview-frame:hover {
        margin: 0;
        padding: 0;
        border: none;
        box-shadow: none;
        text-align: center;
    }

    .kv-avatar .file-input {
        display: table-cell;
        max-width: 220px;
    }
</style>

<form asp-controller="User" asp-action="Register" method="post">
    <input asp-for="ProfileId" class="hidden" />
    <input asp-for="UserId" class="hidden" />
    <input asp-for="PersonId" class="hidden" />
    <input asp-for="Avatar" id="txtAvatar" class="hidden" />

    <div class="content-wrapper" style="margin-left: 0; ">
        <div class="content">
            <div class="col-md-3">

                <div class="box box-primary">
                    <div class="box-body box-profile">
                        <img class="profile-user-img img-responsive img-circle" alt="User profile picture" src="@Model.Avatar" />

                        <h3 class="profile-username text-center">@(Model.PersonName + " " + Model.PersonSurname)</h3>

                        <p class="text-muted text-center">@Model.UserType</p>

                        <ul class="list-group list-group-unbordered">
                            <li class="list-group-item">
                                <b>Cuenta</b> <a class="pull-right">@Model.Account</a>
                            </li>
                            <li class="list-group-item">
                                <b>Tareas Implementadas</b> <a class="pull-right">1,322</a>
                            </li>
                            <li class="list-group-item">
                                <b>Tareas Pendientes</b> <a class="pull-right">543</a>
                            </li>
                            <li class="list-group-item">
                                <b>Tareas Iniciadas</b> <a class="pull-right">13,287</a>
                            </li>
                        </ul>

                    </div>
                </div>

            </div>

            <div class="col-md-9">
                <div class="nav-tabs-custom">
                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#settings" data-toggle="tab">Información</a></li>
                    </ul>

                    <div class="tab-content">

                        <div class="active tab-pane" id="settings">

                            <div id="kv-avatar-errors-2" class="center-block" style="width:800px;display:none"></div>

                            <div class="kv-avatar center-block" style="width:200px">
                                <input id="avatar-2" name="avatar-2" type="file" class="file-loading" base-sixty-four-input>
                            </div>

                            <div style="margin-top: 7px;"></div>

                            <div class="row">
                                <div class="col-sm-2">
                                    <label asp-for="Code" class="control-label"></label>
                                </div>
                                <div class="col-sm-4">
                                    <input class="form-control input-sm" asp-for="Code">
                                    <span asp-validation-for="Code" class="text-danger"></span>
                                </div>

                                <div class="col-sm-2">
                                    <label class="control-label" asp-for="Name"></label>
                                </div>
                                <div class="col-sm-4">
                                    <input class="input-sm form-control" asp-for="Name">
                                    <span asp-validation-for="Name" class="text-danger"></span>
                                </div>
                            </div>

                            <div style="margin-top: 7px;"></div>

                            <div class="row">

                                <div class="col-sm-2">
                                    <label asp-for="Email" class="control-label"></label>
                                </div>
                                <div class="col-sm-4">
                                    <input class="form-control input-sm" asp-for="Email">
                                    <span asp-validation-for="Email" class="text-danger"></span>
                                </div>

                                <div class="col-sm-2">
                                    <label class="control-label" asp-for="UserType"></label>
                                </div>
                                <div class="col-sm-4">
                                    <select asp-for="IdTypeUser" asp-items="ViewBag.UserTypes" class="form-control input-sm">
                                        <option>---Seleccionar---</option>
                                    </select>
                                    <span asp-validation-for="IdTypeUser" class="text-danger"></span>
                                </div>
                            </div>

                            <div style="margin-top: 7px;"></div>

                            <div class="row">

                                <div class="col-sm-2">
                                    <label asp-for="PersonName" class="control-label"></label>
                                </div>
                                <div class="col-sm-4">
                                    <input class="form-control input-sm" asp-for="PersonName">
                                    <span asp-validation-for="PersonName" class="text-danger"></span>
                                </div>

                                <div class="col-sm-2">
                                    <label class="control-label" asp-for="PersonSurname"></label>
                                </div>
                                <div class="col-sm-4">
                                    <input class="input-sm form-control col-sm-4" asp-for="PersonSurname">
                                    <span asp-validation-for="PersonSurname" class="text-danger"></span>
                                </div>
                            </div>

                            <div style="margin-top: 7px;"></div>

                            <div class="row">

                                <div class="col-sm-2">
                                    <label asp-for="TypeDocument" class="control-label"></label>
                                </div>
                                <div class="col-sm-4">
                                    <select asp-for="TypeDocument" class="form-control input-sm">
                                        <option>--Seleccionar--</option>
                                        <option value="CI">Natural</option>
                                        <option value="RUC">Jurídica</option>
                                    </select>
                                    <span asp-validation-for="TypeDocument" class="text-danger"></span>
                                </div>

                                <div class="col-sm-2">
                                    <label class="control-label" asp-for="Document"></label>
                                </div>
                                <div class="col-sm-4">
                                    <input class="input-sm form-control col-sm-4" asp-for="Document">
                                    <span asp-validation-for="Document" class="text-danger"></span>
                                </div>
                            </div>

                            <div style="margin-top: 7px;"></div>

                            <div class="row">

                                <div class="col-sm-2">
                                    <label asp-for="Mobile" class="control-label"></label>
                                </div>
                                <div class="col-sm-4">
                                    <input class="form-control input-sm" asp-for="Mobile">
                                </div>

                                <div class="col-sm-2">
                                    <label class="control-label" asp-for="Phone"></label>
                                </div>
                                <div class="col-sm-4">
                                    <input class="input-sm form-control col-sm-4" asp-for="Phone">
                                </div>
                            </div>

                        </div>

                        <div style="margin-top: 14px;"></div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-primary" onclick="SetImageB64();">Aceptar</button>
                            <a class="btn btn-link" href="@Url.Action("Index","User")">Salir</a>
                        </div>

                        <!-- /.tab-pane -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

@section scripts{
    <script>

        $(document).ready(function () {
            $('.inputeditable').editable({
                success: function (response, newValue) {
                    debugger;
                    var elm = "#txt" + this.id;
                    $(elm).val(newValue);
                }
            });
        });

        $.fn.editable.defaults.mode = 'inline';

        filters = "@ViewData["currentFilter"]";

        var btnCust = '<button type="button" class="btn btn-default" title="Add picture tags" ' +
                        'onclick="alert(\'Call your custom code here.\')">' +
                        '<i class="glyphicon glyphicon-tag"></i>' +
                        '</button>';

        $("#avatar-2").fileinput({
            overwriteInitial: true,
            maxFileSize: 1500,
            showClose: false,
            showCaption: false,
            showBrowse: false,
            browseOnZoneClick: true,
            removeLabel: '',
            removeIcon: '<i class="glyphicon glyphicon-remove"></i>',
            removeTitle: 'Cancel or reset changes',
            elErrorContainer: '#kv-avatar-errors-2',
            msgErrorClass: 'alert alert-block alert-danger',
            defaultPreviewContent: '<img src="@Model.Avatar" alt="Your Avatar" style="width:160px"><h6 class="text-muted"></h6>',
            layoutTemplates: { main2: '{preview}  {remove} {browse}' },
            allowedFileExtensions: ["jpg", "png", "gif"]
        });

        //../../images/default_avatar_male.jpg

        var handleFileSelect = function (evt) {
            var files = evt.target.files;
            var file = files[0];

            if (files && file) {
                var reader = new FileReader();

                reader.onload = function (readerEvt) {
                    var binaryString = readerEvt.target.result;
                    $("#txtAvatar").val('data:image/gif;base64,' + btoa(binaryString));
                };

                reader.readAsBinaryString(file);
            }
        };

        if (window.File && window.FileReader && window.FileList && window.Blob) {
            document.getElementById('avatar-2').addEventListener('change', handleFileSelect, false);
        } else {
            alert('The File APIs are not fully supported in this browser.');
        }

    </script>
}